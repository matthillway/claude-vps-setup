# ==============================================================================
# Tmux Configuration for Claude Code VPS Setup
# ==============================================================================
# Author: Matt Fitzgerald / Hillway Property Consultants
# Purpose: Optimized tmux config for running Claude Code sessions
# ==============================================================================

# ------------------------------------------------------------------------------
# General Settings
# ------------------------------------------------------------------------------

# Use 256 colors
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Increase scrollback buffer to 50000 lines
set -g history-limit 50000

# Start window and pane numbering from 1 (easier to reach on keyboard)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Faster command sequences (reduce escape time)
set -sg escape-time 0

# Increase repeat time for repeatable commands
set -g repeat-time 1000

# Enable focus events (useful for some applications)
set -g focus-events on

# ------------------------------------------------------------------------------
# Prefix Key - Change from Ctrl+B to Ctrl+A
# ------------------------------------------------------------------------------

# Unbind default prefix
unbind C-b

# Set new prefix to Ctrl+A
set -g prefix C-a

# Allow sending Ctrl+A to applications by pressing it twice
bind C-a send-prefix

# ------------------------------------------------------------------------------
# Mouse Support
# ------------------------------------------------------------------------------

# Enable mouse mode (scroll, select panes, resize panes)
set -g mouse on

# ------------------------------------------------------------------------------
# Key Bindings - Window Management
# ------------------------------------------------------------------------------

# Reload config file with prefix + r
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Create new window with current path
bind c new-window -c "#{pane_current_path}"

# Navigate windows with prefix + h/l or just Alt + h/l
bind -n M-h previous-window
bind -n M-l next-window

# ------------------------------------------------------------------------------
# Key Bindings - Pane Splitting (Intuitive)
# ------------------------------------------------------------------------------

# Split panes using | and - (more intuitive than % and ")
bind | split-window -h -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"

# Unbind old split keys
unbind '"'
unbind %

# ------------------------------------------------------------------------------
# Key Bindings - Pane Navigation (Vim-style)
# ------------------------------------------------------------------------------

# Navigate panes with prefix + h/j/k/l
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Navigate panes without prefix using Alt + arrow keys
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# ------------------------------------------------------------------------------
# Key Bindings - Pane Resizing
# ------------------------------------------------------------------------------

# Resize panes with prefix + H/J/K/L (uppercase, repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Fine-grained resize with Shift + arrow keys (no prefix needed)
bind -n S-Left resize-pane -L 2
bind -n S-Right resize-pane -R 2
bind -n S-Up resize-pane -U 2
bind -n S-Down resize-pane -D 2

# ------------------------------------------------------------------------------
# Key Bindings - Copy Mode (Vim-style)
# ------------------------------------------------------------------------------

# Use vim keybindings in copy mode
setw -g mode-keys vi

# Enter copy mode with prefix + v
bind v copy-mode

# In copy mode: v to begin selection, y to copy
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Copy to system clipboard (macOS)
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Mouse selection copies to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# ------------------------------------------------------------------------------
# Key Bindings - Session Management
# ------------------------------------------------------------------------------

# Kill pane without confirmation
bind x kill-pane

# Kill window without confirmation
bind X kill-window

# Detach with prefix + d (default, but explicit)
bind d detach-client

# List sessions
bind s choose-session

# ------------------------------------------------------------------------------
# Key Bindings - Claude Code Specific
# ------------------------------------------------------------------------------

# Quick new Claude session in new window
bind C new-window -n "claude" "claude"

# Split and run Claude in new pane
bind M-c split-window -h -c "#{pane_current_path}" "claude"

# ------------------------------------------------------------------------------
# Status Bar Configuration
# ------------------------------------------------------------------------------

# Update status bar every second
set -g status-interval 1

# Status bar position
set -g status-position bottom

# Status bar colors
set -g status-style bg=colour235,fg=colour137

# Left side of status bar
set -g status-left-length 40
set -g status-left "#[fg=colour232,bg=colour33,bold] #S #[fg=colour33,bg=colour235,nobold]"

# Right side of status bar
set -g status-right-length 100
set -g status-right "#[fg=colour245] #H #[fg=colour245,bg=colour235]#[fg=colour232,bg=colour245,bold] %H:%M:%S #[fg=colour33,bg=colour245]#[fg=colour232,bg=colour33,bold] %d-%b-%y "

# Window status format
setw -g window-status-format " #I:#W#F "
setw -g window-status-current-format "#[fg=colour235,bg=colour33]#[fg=colour232,bg=colour33,bold] #I:#W#F #[fg=colour33,bg=colour235]"

# Window status colors
setw -g window-status-style fg=colour244,bg=colour235
setw -g window-status-current-style fg=colour232,bg=colour33,bold

# Pane border colors
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour33

# Message colors
set -g message-style bg=colour33,fg=colour232,bold

# ------------------------------------------------------------------------------
# Activity Monitoring
# ------------------------------------------------------------------------------

# Monitor activity in other windows
setw -g monitor-activity on
set -g visual-activity off

# Activity window styling
setw -g window-status-activity-style fg=colour166,bg=colour235,bold

# ------------------------------------------------------------------------------
# Notes
# ------------------------------------------------------------------------------
#
# Key Bindings Quick Reference:
#
# Prefix = Ctrl+A
#
# Sessions:
#   prefix + s      - List sessions
#   prefix + d      - Detach
#   prefix + $      - Rename session
#
# Windows:
#   prefix + c      - New window
#   prefix + ,      - Rename window
#   prefix + n      - Next window
#   prefix + p      - Previous window
#   Alt + h/l       - Previous/Next window (no prefix)
#   prefix + C      - New window with Claude Code
#
# Panes:
#   prefix + |      - Split horizontally
#   prefix + -      - Split vertically
#   prefix + h/j/k/l - Navigate panes
#   Alt + arrows    - Navigate panes (no prefix)
#   prefix + H/J/K/L - Resize panes
#   Shift + arrows  - Resize panes (no prefix)
#   prefix + x      - Kill pane
#   prefix + z      - Toggle pane zoom
#
# Copy Mode:
#   prefix + v      - Enter copy mode
#   v               - Begin selection (in copy mode)
#   y               - Copy selection (in copy mode)
#
# Config:
#   prefix + r      - Reload config
#
# ==============================================================================
